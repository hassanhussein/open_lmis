<!--
  ~ This program is part of the OpenLMIS logistics management information system platform software.
  ~ Copyright Â© 2013 VillageReach
  ~
  ~  This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~  You should have received a copy of the GNU Affero General Public License along with this program.  If not, see http://www.gnu.org/licenses.  For additional information contact info@OpenLMIS.org.
  -->


<div xmlns="http://www.w3.org/1999/html" tab-scroll>
    <div>
        <h2 >Vaccine Distribution</h2>


    </div>


    <form name="distributionForm"  novalidate>
        <div class="app-form">

            <div class="form-group clear-top">

                <div class="form-row clearfix">



                    <div class="span4">
                        <label for="receiptDate">
                            <span>Distribution Date</span>
                            <span class="label-required"> *</span>
                        </label>

                        <div class="form-field">
                            <input id="receiptDate"
                                   type="text"
                                   ui-date="{dateFormat: 'dd/mm/yy', changeYear: false,maxDate:'today',minDate:period.stringStartDate}"
                                   ui-date-format="yy-mm-dd"
                                   ng-model="asnReceiptDate" name="asnReceiptDate"
                                   ng-disabled="viewMode"
                                   ng-required="true"/>
                            <span class="field-error" ng-show="distributionForm.asnReceiptDate.$error.required && showError"
                                  openlmis-message="missing.value"></span>
                        </div>
                    </div>

                    <div class="span4">
                        <label for="supplier" >Distribution Type <span class="label-required"> *</span></label>


                        <div class="form-field row-fluid">
                            <select ui-select2="{width: '90%'}" class="span11" id="supplier"
                                    openlmis-message="label.select.parent.zone"
                                    ng-disabled="viewMode"
                                    name="supplier"
                                    ng-required="true"
                                    ng-model="supplierId">
                                <option value="">Routine</option>
                                <option value="">Campaign</option>


                            </select>
                            <span class="field-error" ng-show="asnForm.supplier.$error.required && showError"
                                  openlmis-message="missing.value"></span>
                        </div>
                    </div>

                </div>

                <br>

                <div class="form-row clearfix">
                    <table class="table table-bordered receive" style="display:block;overflow-x:auto;"  >
                        <tr class="gradient-header">
                            <th class="tg-lboi" colspan="4">Distribute to:</th>
                            <th  ng-repeat="req in requstions" colspan="3">{{req.name}}</th>
                        </tr>
                        <tr class="gradient-header">
                            <th  colspan="4"></th>
                            <th  ng-repeat-start="req in requstions">Qty Ordered</th>
                            <th >Qty to Issue</th>
                            <th  ng-repeat-end>Gap</th>
                        </tr>
                        <!-- done -->

                        <tr ng-repeat-start="p in soh">
                            <td  colspan="4">{{p.product}}</td>
                            <td class="cell-input" style="padding-left: 15px;"  ng-repeat-start="x in range(requstions.length) track by $index" rowspan="{{p.lots.length+2}}">{{getOrderedQuantity($index,p.productId)}}</td>
                            <td  rowspan="2"></td>
                            <td class="cell-input" style="padding-left: 15px;" rowspan="{{p.lots.length+2}}" ng-repeat-end>{{getGap($index,p)}}</td>
                        </tr>
                        <tr class="gradient-header">
                            <td >Batch</td>
                            <td >VVM</td>
                            <td >Exp Date</td>
                            <td >SOH</td>
                        </tr>
                        <tr ng-repeat-end ng-repeat="lot in p.lots" ng-init="lotIndex = $index">
                            <td >{{lot.number}}</td>
                            <td >{{lot.vvm}}</td>
                            <td >{{lot.expiry}}</td>
                            <td >{{lot.amount}}</td>
                            <td class="cell-input"  ng-repeat="req in requstions" >
                                <input ng-change="giveLot(req,p,lot,qty,$index)" ng-model="qty" ng-disabled="lotIndex>0 && p.lots[lotIndex-1].amount>0" type="text">
                            </td>

                        </tr>

                    </table>
                </div>

            </div>

        </div>


        <div form-toolbar id="action_buttons" class="action-buttons">
            <div class="form-cell button-row">
                <input id="saveButton" type="submit" class="btn btn-primary save-button"
                       openlmis-message="button.save" ng-click="saveAsn('DRAFT')" ng-if="!viewMode"/>
                <!--                    <input type="button"  class="btn btn-primary save-button" ng-if="viewMode" ng-click="print()"-->
                <!--                            value="Print"/>-->
                <input id="cancelButton" type="button" class="btn btn-cancel cancel-button" openlmis-message="button.cancel"
                       ng-click="cancel()"/>





            </div>

            <div class="toolbar-error" id="saveErrorMsgDiv" openlmis-message="error" ng-show="error"></div>
        </div>

    </form>


</div>

