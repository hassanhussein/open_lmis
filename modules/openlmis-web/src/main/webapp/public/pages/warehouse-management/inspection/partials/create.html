<!--
  ~ This program is part of the OpenLMIS logistics management information system platform software.
  ~ Copyright Â© 2013 VillageReach
  ~
  ~  This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~  You should have received a copy of the GNU Affero General Public License along with this program.  If not, see http://www.gnu.org/licenses.  For additional information contact info@OpenLMIS.org.
  -->

<div xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html" tab-scroll>
    <div>
        <h2>Inspect Package</h2>


    </div>




    <form name="inspectionForm"  novalidate>
        <div class="app-form">

            <div class="form-group clear-top">

                <div class="form-row clearfix">
                    <div class="span3">
                        <label for="inspectionDate">
                            <span >Inspection Date</span>
                            <span class="label-required"> *</span>
                        </label>

                        <div class="form-field">
                            <input id="inspectionDate" name="inspectionDate"
                                    type="text"
                                   ui-date-format="yy-mm-dd"
                                   ui-date="{dateFormat: 'dd/mm/yy', changeYear: true, maxDate:'today'}"
                                    ng-model="inspection.inspectionDate"
                                    ng-disabled="isDisabled(inspection.status)"
                                    ng-required="true"/>
                            <span class="field-error" ng-show="inspectionForm.inspectionDate.$error.required && showError"
                                  openlmis-message="missing.value"></span>
                        </div>
                    </div>
                    <div class="span3">
                        <label for="receiptNumber">
                            <span >GRN Number</span>

                        </label>

                        <div class="form-field">
                            <input id="receiptNumber" ng-model="inspection.receive.receiveLineItems[0].receiveNumber" ng-disabled="true" type="text" maxlength="50" />

                        </div>
                    </div>


                    <div class="span3">
                        <label for="receiveDate">
                            <span >Receive Date</span>
                            <span class="label-required"> *</span>
                        </label>

                        <div class="form-field">
                            <input id="receiveDate"
                                    type="text"
                                    ui-date="{dateFormat: 'dd/mm/yy', changeYear: false,maxDate:'today',minDate:period.stringStartDate}"
                                    ui-date-format="yy-mm-dd"
                                    ng-model="inspection.receive.receiveDate"
                                    ng-disabled="true"
                                    ng-required="true"/>
                            <span class="field-error" ng-show="inspectionForm.receiveDate.$error.required && showError"
                                  openlmis-message="missing.value"></span>
                        </div>
                    </div>


                    <div>



                    </div>


                </div>



                <div class="form-row clearfix">
                    <div class="span3">
                        <label for="asnNumber">
                            <span >Invoice Number</span>

                        </label>

                        <div class="form-field">
                            <input id="asnNumber" ng-model="inspection.invoiceNumber" name="invoiceNumber" ng-disabled="true" type="text" maxlength="50" />

                        </div>
                    </div>

                    <div class="span3">
                        <label for="supplierLabel">
                            <span>Supplier</span>
                        </label>

                        <div class="form-field">
                            <input id="supplierLabel" ng-model="inspection.receive.supplier.name" name="supplier" ng-disabled="true" type="text" maxlength="50" />

                        </div>

                  <!--      <div class="form-field row-fluid">
                            <select ui-select2="{width: '100%'}" class="span11" id="supplier"
                                    openlmis-message="label.select.parent.zone" ng-disabled="true"
                            ng-model="inspection.receive.supplier.name">
                                <option value=""></option>
                                    <option ng-repeat="supplier in suppliers"
                                            value="{{ supplier.id }}"
                                            ng-selected="supplierId==supplier.id"
                                    >
                                        {{ supplier.name }}
                                    </option>
                            </select>
                            <span class="field-error" ng-show="inspectionForm..$error.required && showError"
                                  openlmis-message="missing.value"></span>
                        </div>-->
                    </div>
                    <div class="span3">
                        <label for="poNumberLabel">
                            <span >PO Number</span>
                            <span class="label-required"> *</span>
                        </label>

                        <div class="form-field">
                            <input id="poNumberLabel" ng-model="inspection.receive.poNumber" ng-disabled="true"  type="text" maxlength="50" name="poNumber" ng-required="true"/>
                            <span class="field-error" ng-show="asnForm.inspection.poNumber.$error.required && showError"
                                  openlmis-message="missing.value"></span>
                        </div>
                    </div>

                    <div class="span3">
                        <label for="poDate">
                            <span >PO Date</span>
                            <span class="label-required"> *</span>
                        </label>

                        <div class="form-field">
                            <input  name="poDate" id="poDate"
                                    type="text"
                                   ui-date="{dateFormat: 'dd/mm/yy', changeYear: false,maxDate:'today',minDate:period.stringStartDate}"
                                   ui-date-format="yy-mm-dd"
                                   ng-model="inspection.receive.poDate"
                                    ng-disabled="true"
                                    ng-required="true"/>
                            <span class="field-error" ng-show="asnForm.poDate.$error.required && showError"
                                  openlmis-message="missing.value"></span>
                        </div>
                    </div>


                </div>

                <div class="form-row clearfix">
                    <div class="span6">
                        <label id="descriptionLabel" for="description">
                            <span >Description of Procurement</span>
                            <!--                                        <span class="label-required"> *</span>-->
                        </label>

                        <div class="form-field">
                            <textarea id="description" rows="3" ng-disabled="true" style="width: 425px;" ng-model="inspection.descriptionOfInspection" ></textarea>

                        </div>
                    </div>


<!--                    <div class="span6">-->
<!--                        <label id="codeLabel" for="code">-->
<!--                            <span >Note to Supplier</span>-->
<!--                            &lt;!&ndash;                                        <span class="label-required"> *</span>&ndash;&gt;-->
<!--                        </label>-->

<!--                        <div class="form-field">-->
<!--                            <textarea ng-disabled="viewMode" rows="3" style="width: 425px;" ng-model="notes" ></textarea>-->

<!--                        </div>-->
<!--                    </div>-->

                </div>



                <div class="form-row clearfix">

                    <div class="form-cell" >
                        <label class="checkbox inline">
                            <input type="radio" ng-model="switchData" ng-disabled="viewMode || (editMode && !isVaccine)" ng-init="switchData=2"  value="2" ng-click="changeProductType(true)"> Vaccines/Associated Products
                        </label>
                        <label class="checkbox inline">
                            <input type="radio" ng-model="switchData" ng-disabled="true"   value="1" ng-click="changeProductType(false)" > Other Items
                        </label>

                    </div>




                </div>


                <div class="form-row clearfix">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#tab1" data-toggle="tab" target="_self">Item Info</a>
                        </li>
                        <li ><a href="#tab2" data-toggle="tab" target="_self">Shipment info</a></li>
                        <li ><a href="#tab3" data-toggle="tab" target="_self">Documents</a></li>
                        <li ><a href="#tab4" data-toggle="tab" target="_self">Inspection Findings</a></li>

                    </ul>

                    <div class="tab-content">
                        <div class="tab-pane active" id="tab1">
                            <div ng-switch="switchData" id="wrapper">
                                <div ng-switch-when="1">
                                    <table class="table table-bordered receive">
                                        <thead>
                                        <tr class="gradient-header">
                                            <th>Product</th>
                                            <th>Unit of Measurement</th>
                                            <th>Quantity</th>
                                            <th>Unit Price {{currency.code?'('+currency.code+')':''}}</th>
                                            <th>Total Cost {{currency.code?'('+currency.code+')':''}}</th>
                                            <th>Location</th>
                                            <th>Action</th>


                                        </tr>
                                        </thead>
                                        <tbody id="append-element">
                                        <tr data-ng-repeat="product in productsToAdd" ng-init="productIndex=$index">
                                            <td  class="cell-input" style="padding-left:15px;">
                                                <select style="width:90% !important;" ui-select2
                                                        ng-show="!product.displayNameOnly"
                                                        ng-model="product.programProduct"
                                                        ng-options="obj.programProduct  as obj.programProduct.product.primaryName for obj in productsToDisplay">
                                                    <option value="" openlmis-message="placeholder.select.product"></option>
                                                </select>
                                                <div class="row-fluid" ng-show="product.displayNameOnly">
                                                    {{product.programProduct.product.primaryName}}
                                                </div>
                                            </td>
                                            <td>
                                                <span ng-bind="product.programProduct.product.dosageUnit.code" ></span>
                                                <span class="row-fluid" >
                                                {{product.programProduct.dosageUnit.code}}

                                            </span>
                                            </td>
                                            <td class="col-general">
                                                <input type="text" numeric-validator="positiveInteger" ng-model="product.quantity">
                                            </td>
                                            <td class="col-general">
                                                <input type="text" ng-decimal="5" ng-model="product.unitPrice">
                                            </td>

                                            <td>{{(product.quantity*product.unitPrice)?product.quantity*product.unitPrice:0 | number}}</td>
                                            <td>
                                                <select

                                                >
                                                    <option value=""  ng-disabled="viewMode">--Select Location--</option>
                                                    <option ng-repeat="location in locations"
                                                            value="{{ location.id }}">
                                                        {{ location.name }}({{location.typename}})
                                                    </option>



                                                </select>
                                            </td>

                                            <td ><span class="btn btn-danger" ng-click="removeProduct(productIndex)"><i class="icon-remove"></i></i></span></td>
                                        </tr>

                                        </tbody>

                                        <tfoot>
                                        <tr>
                                            <td colspan="3">
                                                <button class="btn btn-small btn-info" type="button" ng-click="addProduct()">Add Product</button>

                                            </td>




                                            <th >Grand Total {{currency.code?'('+currency.code+')':''}}</th>

                                            <td colspan="3" style="text-align:right;">{{grandTotal() | number}}</td>


                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>

                                <div ng-switch-when="2">
                                    <div  class="alert alert-danger" ng-show="productError">
                                        Atleast One product with atleast One batch is required
                                    </div>

                                    <div  class="alert alert-danger" ng-show="quantityBoxError">
                                        Quantity should be greater or equal to Number of Boxes
                                    </div>
                                    <table  class="table table-bordered receive">
                                        <thead>
                                        <tr class="gradient-header">
                                            <th class="col-product" style="width:350px !important;" openlmis-message="label.products"></th>
                                            <th class="col-product" style="width:100px !important;max-width:100px !important">
                                            Unit Of Measure
                                            </th>
                                            <th  class="col-add-lot" style="width:100px !important;max-width:100px !important;">Received Qty</th>
                                            <th  class="col-add-lot" style="width:100px !important;max-width:100px !important" ng-if="lotInspected" >Passed Qty</th>
                                            <th  class="col-add-lot" style="width:100px !important; max-width:100px !important" ng-if="lotInspected">Failed Qty</th>
                                            <th ng-if="!viewMode" style="width:100px !important;max-width:100px !important" class="col-add-lot"><span>Inspect</span></th>

                                        </tr>
                                        </thead>
                                        <tbody ng-repeat="lineItem in inspection.lineItems">

                                        <tr>
                                            <td>
                                                <span style="padding-left: 15px;">{{lineItem.product.primaryName}}</span>
                                            </td>
                                            <td style="padding-left: 15px;">
                                                Vials
                                            </td>
                                            <td >{{totalReceivedQty}}</td>
                                            <td style="text-align:right" ng-if="lotInspected">{{totalPassQty | number}}</td>
                                            <td style="text-align:right" ng-if="lotInspected">{{totalFailQty | number }}</td>
                                            <td ng-class="{'quadrat':enabled}">
                                                <a href="" ng-click="showInspectLotModal(lineItem)" class="btn btn-link">Lots</a>
                                            </td>

                                        </tr>
                                        </tbody>
                                        <tfoot>

                                        </tfoot>
                                    </table>
                                </div>

                            </div>


                        </div>
                        <div class="tab-pane" id="tab2">
                            <div class="form-row clearfix">
                                <div class="span3">
                                    <label id="codeLabel" for="blawBnumber">
                                        <span >BL/AWB Number</span>
                                        <span class="label-required"> *</span>
                                    </label>

                                    <div class="form-field">
                                        <input id="blawBnumber" ng-model="inspection.receive.blawBnumber" ng-disabled="true"  type="text"  maxlength="50" name="blAwbNumber" ng-required="true"/>
                                        <span class="field-error" ng-show="asnForm.inspection.receive.blawBnumber.$error.required && showError"
                                              openlmis-message="missing.value"></span>
                                    </div>
                                </div>

                                <div class="span3">
                                    <label for="portOfArrival" >Destination Airport/Port</label>

                                    <div class="form-field">
                                        <input id="portOfArrival" ng-model="inspection.receive.port.name" ng-disabled="true"  type="text"  maxlength="50" name="portOfArrival" ng-required="true"/>
                                        <span class="field-error" ng-show="asnForm.inspection.receive.port.name.$error.required && showError"
                                              openlmis-message="missing.value"></span>
                                    </div>

                                <!--    <div class="form-field row-fluid">
                                        <select ui-select2="{width: '90%'}" class="span11" ng-disabled="true"  ng-model="inspection.receive.port.name"
                                                openlmis-message="label.select.parent.zone">
                                            <option value=""></option>

                                                <option ng-repeat="port in ports"
                                                        value="{{ port.id }}">
                                                    {{ port.name }}
                                                </option>

                                        </select>
                                        <span class="field-error" ng-show="geoZoneForm.parent.code.$error.required && showError"
                                              openlmis-message="missing.value"></span>
                                    </div>-->
                                </div>
                                <div class="span3">
                                    <label id="codeLabel" for="flightVesselNumber">
                                        <span >Flight/Vessel Number</span>
                                        <span class="label-required"> *</span>
                                    </label>

                                    <div class="form-field">
                                        <input id ="flightVesselNumber" ng-model="inspection.receive.flightVesselNumber" ng-disabled="true"  type="text" maxlength="50" name="flightVesselNumber" ng-required="true"/>
                                        <span class="field-error" ng-show="asnForm.flightVesselNumber.$error.required && showError"
                                              openlmis-message="missing.value"></span>
                                    </div>
                                </div>

                                <div class="span4">
                                    <label for="expectedArrivalDate">
                                        <span >Expected Arrival Date</span>
                                        <span class="label-required"> *</span>
                                    </label>

                                    <div class="form-field">
                                        <input id="expectedArrivalDate" name="expectedArrivalDate"
                                                type="text"
                                               ui-date="{dateFormat: 'dd/mm/yy', changeYear: false,minDate:'today'}"
                                               ui-date-format="yy-mm-dd"
                                               ng-model="inspection.receive.expectedArrivalDate"
                                               ng-disabled="true"
                                               ng-required="true"/>
                                        <span class="field-error" ng-show="asnForm.expectedArrivalDate.$error.required && showError"
                                              openlmis-message="missing.value"></span>
                                    </div>
                                </div>
                        </div>
                            <div class="form-row clearfix">
                                <div class="span6">
                                    <label  for="inspectionNote">
                                        <span >Notes</span>
<!--                                        <span class="label-required"> *</span>-->
                                    </label>

                                    <div class="form-field">
                                        <textarea rows="3" ng-disabled="true"  style="width: 425px;" ng-model="inspection.inspectionNote" id="inspectionNote" ></textarea>

                                    </div>
                                </div>
<!--                                <div class="span3">-->
<!--                                    <label for="clearingAgent">-->
<!--                                        <span >Clearing Agent</span>-->
<!--                                        <span class="label-required"> *</span>-->
<!--                                    </label>-->

<!--                                    <div class="form-field">-->
<!--                                        <input id="clearingAgent" ng-model="inspection.receive.clearingAgent" name="clearingAgent" ng-disabled="true"  type="text" maxlength="50" ng-required="true"/>-->
<!--                                        <span class="field-error" ng-show="asnForm.clearingAgent.$error.required && showError"-->
<!--                                              openlmis-message="missing.value"></span>-->
<!--                                    </div>-->
<!--                                </div>-->
                                <div class="span3">
                                    <label id="clearingAgentLabel" >Clearing Agent<span class="label-required"> *</span></label>

                                    <div class="form-field row-fluid" >
                                       <!-- <select ui-select2="{width: '90%'}"  class="span11" ng-disabled="viewMode"  ng-model="inspection.receive.clearingAgent"
                                                openlmis-message="label.select.parent.zone" ng-required="true">
                                            <option value="">&#45;&#45;Select Agent&#45;&#45;</option>

                                            <option ng-repeat="agent in clearingAgentList"
                                                    value="{{agent.name}}" >{{ agent.name }}
                                            </option>

                                        </select>

                                        <label>
                                            <select ng-options="f as agent.name for  agent in clearingAgentList" ng-model="inspection.receive.clearingAgent">

                                                <option>Select</option>
                                            </select>
                                        </label>
-->
                                        <span class="field-error" ng-show="asnForm.clearingAgent.$error.required && showError"
                                              openlmis-message="missing.value"></span>
                                        <div class="form-field">
                                            <input id ="clearingAgents" ng-model="inspection.receive.clearingAgent" ng-disabled="true"  type="text" maxlength="50"  />
                                            <span class="field-error" ng-show="asnForm.clearingAgent.$error.required && showError"
                                                  openlmis-message="missing.value"></span>
                                        </div>
                                    </div>


                                </div>
                                <div class="span4">
                                    <label id="levelLabel" for="actualArrivalDate">
                                        <span >Actual Time of Arrival</span>
                                        <span class="label-required"> *</span>
                                    </label>

                                    <div class="form-field">
                                        <input id="actualArrivalDate" name="actualArrivalDate"
                                               type="text"
                                               ui-date="{dateFormat: 'dd/mm/yy', changeYear: false,minDate:'today'}"
                                               ui-date-format="yy-mm-dd"
                                               ng-disabled="true"
                                               ng-model="inspection.receive.actualArrivalDate"
                                               ng-required="true"/>
                                        <span class="field-error" ng-show="asnForm.actualArrivalDate.$error.required && showError"
                                              openlmis-message="missing.value"></span>
                                    </div>
                                </div>
                            </div>
                            </div>
                        <div class="tab-pane" id="tab3">
                            <div class="form-row clearfix">
                                <div class="span4" ng-if="!viewMode">
                                    <fieldset>
                                        <label for="model"><span>Document Type</span>:</label>

                                        <select style="min-width:300px !important" ng-disabled="isDisabled(inspection.status)" ui-select2 ng-model="document.documentType"
                                                ng-options="f as f.name for f in displayDocumentTypes">
                                            <option value="">Select Document Type</option>
                                        </select>
                                        <!--    <span class="field-error" ng-show="uploadForm.model.errorMessage"
                                                  ng-bind="uploadForm.model.errorMessage"></span>-->
                                        <br/>
                                        <br/>
                                        <label for="csvFile"><span openlmis-message="upload.label.file"></span>:</label>
                                        <input ng-disabled="!document.documentType" name="csvFile" ngf-select  id="csvFile" ng-model="document.file" type="file" ngf-accept="'image/*,application/pdf'"
                                               ng-change="clearMessages()"
                                               value="Choose CSV File to upload"/>
                                        <!--       <span class="field-error" ng-show="uploadForm.csvFile.errorMessage"
                                                     ng-bind="uploadForm.csvFile.errorMessage"></span>-->
                                        <br/>
                                        <br>


                                        <div class="alert alert-error" id="saveErrorMsgDiv" ng-show="errorMsg">
                                            {{errorMsg}}
                                        </div>
                                        <div class="alert alert-success" id="saveSuccessMsgDiv" ng-show="successMsg">
                                            {{successMsg}}
                                        </div>
                                        <br>
                                        <input id="uploadButton" ng-click="upload(document)" type="submit" openlmis-message="link.admin.upload" class="btn btn-primary"
                                               ng-disabled="!document.documentType">
                                        <br/>
                                        <br/>
                                        <div class="clearfix"></div>


                                        <span style="color:#276E72" ng-show="openMessage">{{message}}</span>

                                    </fieldset>
                                </div>

                                <div class="span8" ng-show="inspection.receive.asn.purchaseDocuments.length > 0">
                                    <h2>List of uploaded Document(s)</h2>

                                    <table class="table table-striped table-bordered">
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Document Type</th>
                                            <th>File Name </th>
                                            <th style="width:200px!important"></th>

                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="document in docLists">

                                            <td>{{$index+1}}</td>
                                            <td ng-class="{'deleted': document.deleted==true}">
                                                <span style="min-width:300px !important" ng-class="{'deleted': document.deleted==true}" title="Created By: {{document.createdByName}}, Created At: {{document.docCreatedDate}}">{{document.documentType.name}}</span>
                                            </td>
                                            <td><span>{{document.fileLocation}}</span></td>

                                            <td style="min-width:200px !important" >
                                                <span ng-click="downloadFile(document.fileLocation,asnCode)"><a href="" ng-show="!document.documentType.disableSelectedRows">Download ({{document.documentType.name}})</a></span>
                                                <span ng-show="document.deleted"  title="Deleted By {{document.deletedByName}} at {{document.deletionLocation}}"  class="text-muted" style="color: #919191">Deleted:({{document.comment}})</span>


                                            </td>

                                            <td ng-if="!viewMode"  >
                                                <div ng-show="document.deleteOption">
                                                    <textarea ng-model="document.comment"
                                                              placeholder="Reason of deletion!" type="text"
                                                              maxlength="50"></textarea>
                                                    <span ng-show="document.alertcomment" class="text-error"
                                                          style="color: darkred">Comment is required!</span>
                                                </div>
                                                <input type="button" style="margin-top: 10px; margin-left: 5px"
                                                       ng-show="document.cancelBtn" class="btn btn-sucess pull-right"
                                                       ng-click="cancelRemoveFileOptions(document)" value="Cancel">

                                                <input type="button" ng-show="!document.deleted" class="btn btn-danger pull-right"
                                                       style="margin-top: 10px;" ng-click="removeFileOptionsInspection(document)"
                                                       value="Remove">

                                            </td>

                                        </tr>
                                        </tbody>
                                    </table>

                                </div>
                                <div class="clear-fix"></div>


                            </div>



                        </div>
                        <div class="tab-pane" id="tab4">
                            <div class="form-horizontal">

<!--                                <div class="row">-->
<!--                                    <div class="span12">-->

<!--                                        <div class="control-group">-->
<!--                                            <label class="control-label">Total box inspected</label>-->
<!--                                            <div class="controls">-->
<!--                                                <input type="text" style="width:220px!important" ng-model="inspection.totalInspected">-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
                                <div class="row">
                                    <div class="span6">

                                        <div class="control-group">
                                            <br/>
                                            <span style="font-size:12px">Was quantity received as per shipping notification?</span>

                                        <span ng-init="inspection.isShipped" >
                                           <strong>Yes</strong><input type="radio" ng-model="inspection.isShipped" ng-disabled="isDisabled(inspection.status)" ng-value="true" /> <strong>No</strong>
                                            <input type="radio" ng-model="inspection.isShipped" ng-disabled="isDisabled(inspection.status)" ng-value="false"/>
                                        </span>

                                        </div>
                                    </div>
                                    <div class="span6">

                                        <div class="control-group">
                                            <label  for="notes">Comments</label>
                                            <input type="text" ng-model="inspection.shippedComment"  ng-disabled="isDisabled(inspection.status)" id="notes">

                                        </div>
                                    </div>
                                </div>


                                <div class="row" ng-show="inspection.isShipped==false">
                                    <div class="span6">

                                        <div class="control-group">

                                            <span style="font-size:12px">If not, Were details of short-shipment provided prior to product arrival?</span>
                                            <span ng-init="inspection.isShippedProvided" >
                                           <strong>Yes</strong><input type="radio" ng-model="inspection.isShippedProvided" ng-value="true" /><strong>No</strong>
                                            <input type="radio" ng-model="inspection.isShippedProvided" ng-value="false"/>
                                        </span>

                                        </div>
                                    </div>
                                    <div class="span6">

                                        <div class="control-group">
                                            <label class="control-label"></label>
                                            <div>
                                                <input type="text" ng-model="inspection.shippedProvidedComment">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="span6">

                                        <div class="control-group">
                                            <span style="font-size:12px">What was the condition of boxes on arrival?</span>
                                        </div>
                                    </div>
                                    <div class="span6">

                                        <div class="control-group">
                                            <label class="control-label"></label>
                                            <div>
<!--                                                <input type="text" ng-model="inspection.conditionOfBox">-->
                                                <select  ng-model="inspection.conditionOfBox" ng-disabled="isDisabled(inspection.status)" >
<!--                                                    <option value=""></option>-->
                                                    <option value="Good Condition">Good Condition</option>
                                                    <option value="Partially damaged">Partially damaged</option>
                                                    <option value="Damaged">Damaged</option>


                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="span6">

                                        <div class="control-group">
                                            <span style="font-size:12px">Were necessary labels attached to shipping boxes?</span>
                                        </div>
                                    </div>
                                    <div class="span6">

                                        <div class="control-group">
                                            <label class="control-label"></label>
                                            <div>
<!--                                                <input type="text" ng-model="inspection.labelAttachedComment">-->
                                                <select ng-model="inspection.labelAttachedComment" ng-disabled="isDisabled(inspection.status)"  >
<!--                                                    <option value=""></option>-->
                                                    <option value="All labels were attached">All labels were attached</option>
                                                    <option value="Some boxes missing labels">Some boxes missing labels</option>
                                                    <option value="No labels were attached">No labels were attached</option>


                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                        </div>

                    </div>
                </div>

                </div>



                <!-- /form-group -->

            </div>
            <div form-toolbar id="action_buttons" class="action-buttons">
                <div class="form-cell button-row">
                    <input id="saveButton" type="submit" ng-if="!viewMode" class="btn btn-primary save-button"
                           ng-disabled="isDisabled(inspection.status)"     openlmis-message="button.save" ng-click="save('DRAFT')"/>
                    <input type="button"  class="btn btn-primary save-button" ng-if="viewMode" ng-click="print()"
                           value="Print"/>
                    <input id="cancelButton" type="button" class="btn btn-cancel cancel-button" openlmis-message="button.cancel"
                           ng-click="cancel()"/>


                  <!--  <input  type="button" class="btn btn-primary pull-right" ng-click="print(inspection)"
                             ng-if="!viewMode" value="Print" style="margin-left:10px;margin-right:10px"/>
-->
                    <input  type="button" class="btn btn-primary pull-right" ng-click="save('IN-PUTAWAY')"
                            ng-disabled="isDisabled(inspection.status)" ng-if="!viewMode" value="Finalize Inspection" style="margin-left:10px;margin-right:10px"/>
                </div>

                <div class="toolbar-error" id="saveErrorMsgDiv" openlmis-message="error" ng-show="error"></div>
            </div>

        </div>
    </form>
    </form>

    <!--Lot Modal-->
    <form id="popup-box"   name="inspectLotForm"  modal="inspectLotModal" options="{'backdrop':'static', 'escape':false}" style="width:97% !important;margin-left:-49% !important" novalidate>
        <div class="modal-header">
            <div class="row-fluid">
                <div class="span4">
                    <h3>Inspect Lots</h3>&nbsp;&nbsp;
                </div>
                <div class="span4">
                    <h3><span openlmis-message="label.product"></span>:{{lineItem.product.primaryName}}</h3>
                </div>
            </div>
        </div>
        <div class="modal-body">

            <div  class="alert alert-danger" ng-show="lotError">
                {{lotsWithError}} : Passed Qty + Failed Qty should be equal to Counted Qty
            </div>

            <div  class="alert alert-danger" ng-show="lotsWithLocationError">
                {{lotsWithLocationError}} : Location(s) not selected!
            </div>

            <div  class="alert alert-danger" ng-show="lotsWithVvmError">
                {{lotsWithVvmError}} : VVM Status not selected!
            </div>


<!--
            <p ng-show="lotError"><strong>The following Batches has errors: </strong> <span style="color:red">{{lotsWithError}}</span>  <strong>Please revise them </strong></p>
-->


            <table  class="table table-bordered receive" style="width:90%">
                <thead>
                <tr class="gradient-header">
                    <th style="width:19%">Lots</th>
                    <th >No. of Boxes </th>
                    <th style="width:14%">Received Qty(Vials)</th>
                    <th style="width:24%">VVM Status </th>
                    <th style="width:14%">Failed Qty(Vials)</th>
                    <th >Fail Reason</th>
                    <th style="width:19%">Fail Location</th>
                </tr>
                </thead>
                <tbody >
                <tr ng-repeat-start="lot in lineItem.lots" >
                    <td rowspan="4">
                        <span> <strong>No: </strong> {{lot.lotNumber}} </span>
                        <div ng-if="hasExpired(lot)">
                            <strong style="color:red;">expired</strong>
                        </div>

                        <div><strong>Exp Date: </strong>{{lot.expiryDate | date:'dd-MM-yyyy' }}</div>

                        <div ><strong>Location: </strong> <span ng-bind="lot.location.code"></span></div>

                    </td>
                    <td rowspan="4"  style="text-align:right" class="cell-input">{{lot.boxNumber}}</td>
                    <td rowspan="4" style="text-align:right" class="cell-input col-general"><input  ng-disabled="true" ng-model="lot.receivedQuantity" type="text"/></td>



                </tr>

                <tr>
                    <td>
                        <div class="span4">VVM Update:</div>
                        <div class="span8"><input type="checkbox" ng-disabled="viewMode" ng-change="vvmUpdateChanged(lot)" ng-model="lot.vvmUpdate">
                        </div>
                    </td>
                    <td></td>
                    <td></td>
                    <td></td>

                </tr>

                <tr ng-repeat-end ng-repeat="vvm in lot.vvm" >
                    <td class="col-general">

                        <div class="" style="margin-top:6px;">
                            <div class="span4">{{getVvmName(vvm.vvmId)}}:</div>
                            <div class="span8"><input type="text" ng-model="vvm.quantity"  ng-disabled="($index==0 && !lot.vvmUpdate)||!($index==0||lot.vvmUpdate)" ng-change="vvmQuantityChanged(vvm,lot)" numeric-validator="positiveInteger">
                            </div>

                        </div>
                    </td>

                    <td style="text-align:right" class="cell-input col-general"><input type="text" numeric-validator="positiveInteger" ng-model="vvm.failed.quantity" ng-change="failedQuantityChanged(vvm)" ng-disabled="hasExpired(lot)||isDisabled(inspection.status)||vvm.quantity==0||vvm.quantity>lot.receivedQuantity||vvm.quantity==undefined"/><span class="field-error" ng-show="lot.failQuantityError"> Failed Qty Should be less/equal than Received Qty</span>



                    </td>



                    <td class="cell-input">
                        <select ui-select2="{width: '100%'}" ng-model="vvm.failed.reasonId" ng-change="reasonChanged(vvm)" ng-disabled="vvm.failed.quantity==0 || !vvm.failed.quantity || hasExpired(lot)||vvm.failed.quantity>vvm.quantity" ng-required="vvm.failed.quantity!=='0' && vvm.failed.quantity">
                            <option value="">--Select Reason--</option>
                            <option ng-repeat="reason in failReasons"
                                    value="{{ reason.id }}"
                                    ng-selected="failReason==reason.id"
                            >
                                {{ reason.name }}
                            </option>
                        </select>
                        <span class="field-error"  ng-show="lot.failReasonError"
                              openlmis-message="missing.value"></span>
                        <select ui-select2="{width: '100%'}" ng-model="vvm.id"  ng-show="vvm.failed.reasonId==4" >
                            <option value="">Select VVM</option>
                            <option ng-repeat="vvmStatus in vvmThreeAndFour"
                                    value="{{ vvmStatus.id }}"
                                    ng-selected="vvm.id==vvmStatus.id"
                            >
                                {{ vvmStatus.name }}
                            </option>
                        </select>
                    </td>

                    <td class="cell-input">

                        <select ui-select2="{width: '100%'}" ng-required="vvm.failed.quantity!=='0' && vvm.failed.quantity" name="failLocationId" ng-model="vvm.failed.locationId" ng-disabled="(vvm.failed.reasonId==undefined||vvm.failed.reasonId==null||vvm.failed.reasonId=='')">
                            <option value="">--Select Location--</option>
                            <option ng-repeat="location in locations"
                                    value="{{ location.id }}"
                                    ng-selected="vvm.failed.locationId==location.id"
                            >
                                {{ location.code }}({{location.typename}})
                            </option>
                        </select>

                        <span class="field-error" ng-show="lot.failLocationError"
                              openlmis-message="missing.value"></span>

                    </td>

                </tr>

<!--                <tr ng-repeat-end ng-repeat="vvm in lot.vvm" >-->
<!--                    <td>-->





<!--                        <div class="">-->
<!--                            <div class="span4">VVM2:</div>-->
<!--                            <div class="span8"><input type="text" numeric-validator="positiveInteger">-->
<!--                            </div>-->

<!--                        </div>-->
<!--                    </td>-->

<!--                    <td style="text-align:right" class="cell-input col-general"><input type="text" numeric-validator="positiveInteger" ng-model="lot.failedQuantity" ng-change="hasZero(lot)" ng-disabled="hasExpired(lot)||isDisabled(inspection.status)"/><span class="field-error" ng-show="lot.failQuantityError"> Failed Qty Should be less/equal than Received Qty</span>-->



<!--                    </td>-->



<!--                    <td class="cell-input">-->
<!--                        <select ui-select2="{width: '100%'}" ng-model="lot.failedReason" ng-disabled="lot.failedQuantity=='0' || !lot.failedQuantity || hasExpired(lot)" ng-required="lot.failedQuantity!=='0' && lot.failedQuantity">-->
<!--                            <option value="">&#45;&#45;Select Reason&#45;&#45;</option>-->
<!--                            <option ng-repeat="reason in failReasons"-->
<!--                                    value="{{ reason.id }}"-->
<!--                                    ng-selected="failReason==reason.id"-->
<!--                            >-->
<!--                                {{ reason.name }}-->
<!--                            </option>-->
<!--                        </select>-->
<!--                        <span class="field-error"  ng-show="lot.failReasonError"-->
<!--                              openlmis-message="missing.value"></span>-->
<!--                        <select ui-select2="{width: '100%'}" ng-model="lot.failedVvm"  ng-show="lot.failedReason==4" >-->
<!--                            <option value="">Select VVM</option>-->
<!--                            <option ng-repeat="vvm in vvmThreeAndFour"-->
<!--                                    value="{{ vvm.id }}"-->
<!--                                    ng-selected="lot.failedVvm==vvm.id"-->
<!--                            >-->
<!--                                {{ vvm.name }}-->
<!--                            </option>-->
<!--                        </select>-->
<!--                    </td>-->

<!--                    <td class="cell-input">-->

<!--                        <select ui-select2="{width: '100%'}" ng-required="lot.failQuantity!=='0' && lot.failQuantity" name="failLocationId" ng-model="lot.failLocationId" ng-disabled="(lot.failedReason==4&&lot.failedReason=='')||(lot.failedVvm=='' && lot.failedReason==4)||(lot.failedReason=='')">-->
<!--                            <option value=""></option>-->
<!--                            <option ng-repeat="location in locations"-->
<!--                                    value="{{ location.id }}"-->
<!--                                    ng-selected="failLocationId==location.id"-->
<!--                            >-->
<!--                                {{ location.code }}-->
<!--                            </option>-->
<!--                        </select>-->

<!--                        <span class="field-error" ng-show="lot.failLocationError"-->
<!--                              openlmis-message="missing.value"></span>-->

<!--                    </td>-->

<!--                </tr>-->
                </tbody>
            </table>


            <div class="form-row clearfix">
                <div class="form-cell" >
                    <label class="checkbox inline">  Total Number of boxes inspected: <span ng-bind="sumBoxes()"></span></label>





                </div>
            </div>

            <div class="form-row clearfix">
                <div class="form-cell" >
                    <label class="checkbox inline">  Coolant Type Available: </label>
                    <label class="checkbox inline">
                        <input type="checkbox" ng-model="lineItem.dryIceFlag" ng-disabled="isDisabled(inspection.status)" name="dryIceFlag" ng-required="!lineItem.noCoolantFlag && !lineItem.icePackFlag" ng-change="coolant(lineItem)"> Dry Ice
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" ng-model="lineItem.icePackFlag" ng-disabled="isDisabled(inspection.status)" name="icePackFlag" ng-required="!lineItem.noCoolantFlag && !lineItem.dryIceFlag" ng-change="coolant(lineItem)"> Icepacks
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" ng-model="lineItem.noCoolantFlag" ng-disabled="isDisabled(inspection.status)" name="noCoolantFlag" ng-required="!lineItem.dryIceFlag && !lineItem.icePackFlag" ng-change="noCoolant(lineItem)"> No Coolant
                    </label>
                    <span class="field-error" ng-show="(inspectLotForm.icePackFlag.$error.required || inspectLotForm.dryIceFlag.$error.required || inspectLotForm.noCoolantFlag.$error.required) && showError"
                          openlmis-message="missing.value"></span>

                </div>
            </div>

            <div class="form-row clearfix">
                <div class="form-cell" >
                    <label class="checkbox inline">  Temperature Monitor Present: </label>
                    <label class="checkbox inline">
                     <input type="checkbox" ng-disabled="isDisabled(inspection.status)" ng-model="lineItem.vvmFlag" > VVM
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" ng-disabled="isDisabled(inspection.status)" ng-model="lineItem.ccCardFlag"> Cold-chain Card
                    </label>
                    <label class="checkbox inline">
                        <input type="checkbox" ng-disabled="isDisabled(inspection.status)" ng-model="lineItem.electronicDeviceFlag"> Electronic devices
                    </label>

                    <label class="checkbox inline">
                      Other Type  <input type="text" ng-disabled="isDisabled(inspection.status)" ng-model="lineItem.otherMonitor">
                    </label>

                </div>
            </div>


            <div class="form-row clearfix">
                <div class="form-cell" >
                    <label class="checkbox inline">  Any Problem Observed? </label>
                    <label class="checkbox inline">
                        <input type="checkbox" ng-disabled="isDisabled(inspection.status)" ng-model="problem" >
                    </label>


                </div>
            </div>

            <div ng-show="problem">
                <h6>
                    PROVIDE DELOW DETAILS OF STATUS ONLY WHEN PROBLEMS ARE OBSERVED
                </h6>
                <p>If different alarms are recorded, please provide comments in the Inspection findings Section</p>

                <table  class="table table-bordered receive">
                    <!--                <thead>-->
                    <tr class="gradient-header">
                        <th rowspan="2" >Box Number</th>
                        <th  rowspan="2"><span>Lot Number</span></th>
                        <th colspan="4" >Alarm in electronic device</th>
                        <th colspan="4">Cold-chain monitor</th>
                    </tr>
                    <!--                </thead>-->
                    <!--                <tbody>-->
                    <tr class="gradient-header">

                        <th>>=45C</th>
                        <th>>=30C</th>
                        <th>>=10C</th>
                        <th><=0.5C</th>
                        <th>A</th>
                        <th>B</th>
                        <th>C</th>
                        <th>D</th>

                    </tr>
                    <tr ng-repeat="lot in lineItem.lots">
                        <td style="width:99px">
                            <input type="text">
                        </td>
                        <td ng-bind="lot.lotNumber">

                        </td>
                        <td>
                            <input type="checkbox">
                        </td> <td>
                        <input type="checkbox">
                    </td> <td>
                        <input type="checkbox">
                    </td> <td>
                        <input type="checkbox">
                    </td> <td>
                        <input type="checkbox">
                    </td> <td>
                        <input type="checkbox">
                    </td>
                        <td>
                            <input type="checkbox">
                        </td>
                        <td>
                            <input type="checkbox">
                        </td>

                    </tr>

                    <!--                </tbody>-->
                </table>

            </div>

        </div>
        <div class="modal-footer">
            <input type="button" id="issueSubmit" class="btn btn-primary save-button"
                   ng-click="doneLotInspection(lineItem)" ng-disabled="isDisabled(inspection.status)"

                   value="Done"/>
            <input type="button" ng-click="closeInspectLotModal();" class="btn btn-cancel"
                   openlmis-message="button.cancel"/>
        </div>

    </form>

    <!--Lot Modal Ends-->
</div>


