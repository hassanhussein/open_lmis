<!--
  ~ This program is part of the OpenLMIS logistics management information system platform software.
  ~ Copyright Â© 2013 VillageReach
  ~
  ~ This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~ You should have received a copy of the GNU Affero General Public License along with this program.  If not, see http://www.gnu.org/licenses.  For additional information contact info@OpenLMIS.org.
  -->
<div ng-controller="CreateProgramProductCategoryController">
<div id="programProductsListModal" modal="programProductsListModal"
     options="{ backdrop: 'static', escape: false}">
<div class="modal-header">
  <h3 id="addProgramProductCategoryHeader"
      openlmis-message="label.add.facility.approved.products|program.name|productCategory.name"></h3>
</div>

<div class="modal-body">


  <div class="row-fluid">

    <div class="span11">
      <label id="productLabel" for="product">
        <span openlmis-message="label.product.code"></span>
      </label>
      <select ui-select2="{formatResult: formatResult, formatSelection: formatSelection}"
              class="span11 bottom-spacer"
              id="product"
              ng-model="productSelected" name="product"
              openlmis-message="placeholder.select.product">
        <option></option>
        <option value="header" class="option-header" disabled="disabled" ng-show="productList.length"
                ng-bind="getHeader()"></option>
        <option value={{product}} ng-repeat="product in productList | limitTo:1000  ">
          {{product.code}} | {{product.primaryName}} | {{product.strength}} | {{product.dosageUnit.code}} |
          {{product.fullSupply}}
        </option>
      </select>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span3">
      <label id="dosesPerMonthId" for="programProduct.dosesPerMonth">
        <span openlmis-message="header.doses.per.months"></span>
        <span class="label-required">*</span>
      </label>
        <span class="position-relative">
          <input type="text" class="span12 right-justified" name="dosesPerMonth"
                 ng-model="newProgramProduct.dosesPerMonth"
                 id="programProduct.dosesPerMonth"
                 numeric-validator="positiveNumericValue,2,2" ng-trim="false" maxlength="5"/><br>
          <span class="rnr-form-error" style="display:none;" id="dosesPerMonth"
                openlmis-message="error.number.only">
          </span>
        </span>
    </div>

    <div class="span3">
      <label id="currentPriceLabel" for="programProduct.currentPrice"
             openlmis-message="header.current.price"></label>
        <span class="position-relative">
          <input type="text" class="span12 right-justified" name="currentPrice"
                 ng-model="newProgramProduct.currentPrice"
                 id="programProduct.currentPrice"
                 numeric-validator="positiveNumericValue,2,2" ng-trim="false" maxlength="5"/><br>
          <span class="rnr-form-error" style="display:none;" id="currentPrice"
                openlmis-message="error.number.only">
          </span>
        </span>
    </div>

    <div class="span3">
      <label id="fullSupplyLabel" for="programProduct.fullSupply"
             openlmis-message="header.full.supply "></label>
        <span class="position-relative">
          <input type="checkbox" class="span12 right-justified" name="fullSupply"
                 ng-model="newProgramProduct.fullSupply"
                 id="programProduct.fullSupply"
                 /><br>

        </span>
    </div>

    <div class="span2">
      <label>&nbsp;</label>
      <input type="button" href="" id="addProgramProduct" class="btn btn-primary"
             ng-click="addProgramProduct()"
             ng-disabled="isAddDisabled()" openlmis-message="button.add"/>
    </div>
  </div>

  <hr/>

  <div class="product-list" ng-show="addedProgramProducts.length">
    <div class="row-fluid product-list-header">
      <div id="addedProductHeader" class="span5 fluid-grid-cell">
        <span openlmis-message="header.product.code"></span>&nbsp;|&nbsp;
        <span openlmis-message="label.name"></span>
      </div>
      <div class="span2 fluid-grid-cell">
        <label id="addedMaxMonthsOfStockHeader">
          <span openlmis-message="header.doses.per.months"></span>
          <span class="label-required">*</span>
        </label>
      </div>
      <div class="span2 fluid-grid-cell">
        <label id="addedMinMonthsOfStockHeader" openlmis-message="header.current.price"></label>
      </div>

    </div>
    <div class="row-fluid"
         ng-repeat="programProduct in addedProgramProducts">

      <div id="addedProductCategory{{$index}}" class="row-fluid productCategory"
           ng-show="showCategory(addedProgramProducts, $index)">
        <div class="fluid-grid-cell"
             ng-bind="programProduct.programProduct.productCategory.name"></div>
      </div>
      <div class="row-fluid">

        <div class="span5">
          <div class="fluid-grid-cell" id="programProductCodeAndName">
            <label id="programProductNameLabel{{$index}}"
                   ng-bind="programProduct.product.code+' | '+programProduct.product.primaryName"></label>
          </div>
        </div>

        <div class="span2">
          <div class="fluid-grid-cell">
            <span class="position-relative">
              <input id="programProduct.maxMonthsOfStock{{$index}}" type="text"
                     ng-class="{'required-error' : (programProduct && !programProduct.maxMonthsOfStock)}"
                     class="right-justified"
                     name="addedMaxMonthsOfStock{{$index}}"
                     numeric-validator="positiveNumericValue,2,2" maxlength="5"
                     ng-required="true" ng-model="programProduct.dosesPerMonth"/>
              <span class="rnr-form-error" style="display:none;"
                    id="addedMaxMonthsOfStock{{$index}}" openlmis-message="error.number.only">
              </span>
            </span>
          </div>
        </div>

        <div class="span2">
          <div class="fluid-grid-cell">
            <span class="position-relative">
              <input id="programProduct.minMonthsOfStock{{$index}}" type="text"
                     class="right-justified"
                     name="addedMinMonthsOfStock{{$index}}"
                     numeric-validator="positiveNumericValue,2,2" maxlength="5"
                     ng-model="programProduct.currentPrice"/>
              <span class="rnr-form-error" style="display:none;"
                    id="addedMinMonthsOfStock{{$index}}" openlmis-message="error.number.only">
              </span>
            </span>
          </div>
        </div>

        <div class="span2">
          <div class="fluid-grid-cell">
            <span class="position-relative">
              <input id="programProduct.eop{{$index}}" type="checkbox"
                     class="right-justified"
                     name="addedEop{{$index}}"
                     ng-model="programProduct.fullSupply"/>

            </span>
          </div>
        </div>

        <div class="span1">
          <div class="fluid-grid-cell delete-role">
            <a id="crossButton{{$index}}" href="" class="close" value="delete"
               ng-click="removeProgramProduct($index)">&times;</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="alert alert-danger" id="modalErrorMessage" ng-show="modalError" openlmis-message="modalError"></div>

<div class="modal-footer">
  <input type="button" id="doneProgramProductCategoryAdd" class="btn btn-primary"
         ng-click="addProgramProducts()"
         openlmis-message="button.done"/>

  <input type="button" id="cancelProgramProductCategoryAdd" class="btn btn-cancel"
         ng-click="cancelProgramProducts();modalError=''"
         openlmis-message="button.cancel"/>
</div>
</div>
</div>